<!DOCTYPE html>
<html lang="en" class="bg-black text-green-400">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BarkWorksTransceiver900</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Scrollbar */
    .scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    .scrollbar::-webkit-scrollbar-thumb {
      background-color: #22c55e;
      border-radius: 4px;
    }

    /* Scroll shadow for chat */
    #chat-box {
      position: relative;
    }
    #chat-box::before {
      content: "";
      position: sticky;
      top: 0;
      height: 15px;
      pointer-events: none;
      background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
      z-index: 10;
      display: block;
    }

    /* Sidebar bottom border active tab */
    .tab-btn.active {
      border-bottom: 3px solid #22c55e;
      color: #a7f3d0;
    }

    /* Chat bubbles */
    .msg {
      max-width: 75%;
      padding: 0.5rem 1rem;
      border-radius: 12px;
      margin-bottom: 0.5rem;
      position: relative;
      word-wrap: break-word;
      font-size: 0.9rem;
      line-height: 1.3;
      user-select: text;
    }
    .msg .sender {
      font-weight: 600;
      color: #86efac;
      margin-bottom: 0.15rem;
    }
    .msg .timestamp {
      font-size: 0.7rem;
      color: #4ade80;
      position: absolute;
      bottom: 4px;
      right: 10px;
    }
    .msg.self {
      background-color: #166534;
      margin-left: auto;
      text-align: right;
      color: #d9f99d;
    }
    .msg.other {
      background-color: #14532d;
      margin-right: auto;
      color: #bbf7d0;
    }
    .msg:hover {
      filter: brightness(1.1);
      cursor: default;
    }

    /* Responsive sidebar -> bottom nav on small screens */
    @media (max-width: 640px) {
      #app {
        flex-direction: column;
      }
      #sidebar {
        flex-direction: row;
        width: 100%;
        height: 56px;
        justify-content: space-around;
        padding: 0;
        border-top: 1px solid #064e3b;
      }
      #sidebar button {
        font-size: 1.6rem;
        padding: 0;
        border: none;
        border-bottom: none !important;
      }
      .tab-btn.active {
        border-bottom: none;
        border-top: 3px solid #22c55e;
      }
      .content {
        flex-grow: 1;
        overflow-y: auto;
        padding: 1rem 0.5rem 0.5rem 0.5rem;
      }
    }
  </style>
</head>
<body class="h-screen flex overflow-hidden font-mono">

<!-- Login Screen -->
<div id="login-screen" class="w-full h-full flex items-center justify-center bg-black">
  <form id="login-form" class="bg-green-900 p-6 rounded shadow space-y-4 w-full max-w-xs">
    <h2 class="text-2xl font-bold text-center">🔐 Login</h2>
    <input type="email" name="email" required placeholder="Email" class="w-full p-2 rounded bg-green-800 text-green-100" />
    <input type="password" name="password" required placeholder="Password" class="w-full p-2 rounded bg-green-800 text-green-100" />
    <button type="submit" class="w-full bg-green-700 hover:bg-green-600 p-2 rounded">Login</button>
  </form>
</div>

<!-- Main App -->
<div id="app" class="hidden h-screen w-full flex" >
  <!-- Sidebar -->
  <div
    id="sidebar"
    class="w-20 bg-green-900 flex flex-col items-center py-6 space-y-8 sm:space-y-0 sm:flex-row sm:justify-around"
  >
    <button data-tab="dashboard" class="tab-btn hover:text-green-300">🪟</button>
    <button data-tab="chat" class="tab-btn hover:text-green-300">💬</button>
    <button data-tab="account" class="tab-btn hover:text-green-300">💵</button>
    <button data-tab="tasks" class="tab-btn hover:text-green-300">⚒️</button>
    <button data-tab="settings" class="tab-btn hover:text-green-300">⚙️</button>
  </div>

  <!-- Main Content -->
  <div class="content flex-1 p-6 overflow-auto scrollbar">
    <div id="dashboard" class="tab hidden">
      <h1 class="text-4xl font-bold mb-6">📋 Dashboard</h1>
      <div class="grid grid-cols-2 gap-6">
        <div class="bg-green-950 p-6 rounded-lg shadow-lg">💰 <strong>Total WoofCoin Balance:</strong> 3,210 WC</div>
        <div class="bg-green-950 p-6 rounded-lg shadow-lg">📉 <strong>Recent Spending:</strong> -50 WC @ WoofMart</div>
        <div class="bg-green-950 p-6 rounded-lg shadow-lg">📈 <strong>Recent Earning:</strong> +150 WC from Task #14</div>
        <div class="bg-green-950 p-6 rounded-lg shadow-lg">
          🧑‍🤝‍🧑 <strong>Friends:</strong><br />
          - Barker ✅<br />
          - Ruff 💤<br />
          - Scrappy Terrier ✅
        </div>
        <div class="bg-green-950 p-6 rounded-lg shadow-lg col-span-2">
          🔨 <strong>Active Tasks:</strong><br />
          - Fix the antenna (Progress 40%)<br />
          - Deliver message to outpost
        </div>
      </div>
    </div>

    <div id="chat" class="tab hidden flex flex-col h-[500px] max-h-[70vh]">
      <h1 class="text-4xl font-bold mb-4">💬 Chat</h1>
      <div
        id="chat-box"
        class="flex-1 overflow-y-auto px-4 py-3 space-y-3 scrollbar bg-green-950 rounded-lg shadow-lg border border-green-700"
      ></div>
      <form id="chat-form" class="flex mt-3 gap-2">
        <input
          id="chat-input"
          autocomplete="off"
          type="text"
          placeholder="Send a message..."
          class="flex-1 rounded bg-green-900 text-green-100 p-3 placeholder-green-400 focus:outline-none focus:ring-2 focus:ring-green-500"
          required
        />
        <button
          type="submit"
          class="bg-green-700 hover:bg-green-600 px-4 rounded text-green-100 font-semibold select-none"
        >
          Send
        </button>
      </form>
    </div>

    <div id="account" class="tab hidden">
      <h1 class="text-4xl font-bold mb-6">💵 Account</h1>
      <div class="bg-green-950 p-6 rounded-lg shadow-lg mb-6">
        <strong>Total Balance:</strong> 3,210 WC
      </div>
      <div class="bg-green-950 p-6 rounded-lg shadow-lg mb-6">
        <strong>Transaction History:</strong><br />
        -50 WC @ WoofMart<br />
        +150 WC Task 14<br />
        -10 WC Loan Repayment
      </div>
      <div class="bg-green-950 p-6 rounded-lg shadow-lg">
        <strong>Loans & Debt:</strong><br />
        Current Debt: 90 WC<br />
        Next Payment Due: 3 Days
      </div>
    </div>

    <div id="tasks" class="tab hidden">
      <h1 class="text-4xl font-bold mb-6">⚒️ Tasks</h1>
      <div class="space-y-6">
        <div class="bg-green-950 p-6 rounded-lg shadow-lg flex items-center justify-between">
          <span>📡 Repair Outpost Beacon</span>
          <div>
            <input type="checkbox" class="mr-2" /> <button class="bg-green-700 hover:bg-green-600 px-3 py-1 rounded">Accept</button>
          </div>
        </div>
        <div class="bg-green-950 p-6 rounded-lg shadow-lg flex items-center justify-between">
          <span>📦 Deliver Supply Crate</span>
          <div>
            <input type="checkbox" class="mr-2" /> <button class="bg-green-700 hover:bg-green-600 px-3 py-1 rounded">Accept</button>
          </div>
        </div>
      </div>
    </div>

    <div id="settings" class="tab hidden">
      <h1 class="text-4xl font-bold mb-6">⚙️ Settings</h1>
      <div class="bg-green-950 p-6 rounded-lg shadow-lg">
        <p>(Settings coming soon... maybe themes, audio alerts, etc?)</p>
      </div>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    onAuthStateChanged,
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    onSnapshot,
    query,
    orderBy,
    serverTimestamp,
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB3UhzvMkOIyF5l7Ic6YZrwo5kxXRkkY_4",
    authDomain: "barkworkstransmissionapp.firebaseapp.com",
    projectId: "barkworkstransmissionapp",
    storageBucket: "barkworkstransmissionapp.firebasestorage.app",
    messagingSenderId: "1000654007316",
    appId: "1:1000654007316:web:81b2fa6dbb4b1be4bfcb01",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const loginForm = document.getElementById("login-form");
  const chatBox = document.getElementById("chat-box");
  const chatForm = document.getElementById("chat-form");
  const messageInput = document.getElementById("chat-input");

  loginForm?.addEventListener("submit", (e) => {
    e.preventDefault();
    const email = e.target.email.value;
    const password = e.target.password.value;
    signInWithEmailAndPassword(auth, email, password).catch((err) => {
      alert("Login failed: " + err.message);
    });
  });

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById("login-screen")?.classList.add("hidden");
      document.getElementById("app")?.classList.remove("hidden");
      showTab("dashboard");
      setupChat();
    }
  });

  async function setupChat() {
    const messagesRef = collection(db, "messages");
    const q = query(messagesRef, orderBy("timestamp"));
    onSnapshot(q, (snapshot) => {
      chatBox.innerHTML = "";
      snapshot.forEach((doc) => {
        const msg = doc.data();
        const div = document.createElement("div");
        const isSelf = auth.currentUser && msg.sender === auth.currentUser.email;
        div.className = "msg " + (isSelf ? "self" : "other");

        const time =
          msg.timestamp?.toDate?.().toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          }) || "sending...";

        div.innerHTML = `
          <div class="sender">${msg.sender || "Anonymous"}</div>
          <div class="text">${msg.text}</div>
          <div class="timestamp">${time}</div>
        `;
        chatBox.appendChild(div);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    chatForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const text = messageInput.value.trim();
      if (text === "") return;
      await addDoc(messagesRef, {
        text,
        sender: auth.currentUser?.email || "Anon",
        timestamp: serverTimestamp(),
      });
      messageInput.value = "";
    });
  }

  function showTab(tabName) {
    document.querySelectorAll(".tab").forEach((tab) => tab.classList.add("hidden"));
    document.getElementById(tabName).classList.remove("hidden");
    document.querySelectorAll(".tab-btn").forEach((btn) => btn.classList.remove("active"));
    const btn = [...document.querySelectorAll(".tab-btn")].find((b) => b.dataset.tab === tabName);
    if (btn) btn.classList.add("active");
  }

  document.querySelectorAll(".tab-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      showTab(btn.dataset.tab);
    });
  });
</script>
</body>
</html>
